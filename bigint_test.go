package ethaddr_test

import (
	"testing"

	"fmt"
	"math/big"

	"github.com/reiver/go-ethaddr"
)

func TestBigInt(t *testing.T) {

	tests := []struct{
		BigInt *big.Int
		Expected ethaddr.Address
	}{
		{
			BigInt: big.NewInt(0),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00} ),
		},
		{
			BigInt: big.NewInt(1),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01} ),
		},
		{
			BigInt: big.NewInt(2),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02} ),
		},
		{
			BigInt: big.NewInt(3),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03} ),
		},
		{
			BigInt: big.NewInt(4),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04} ),
		},
		{
			BigInt: big.NewInt(5),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05} ),
		},
		{
			BigInt: big.NewInt(6),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06} ),
		},
		{
			BigInt: big.NewInt(7),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07} ),
		},
		{
			BigInt: big.NewInt(8),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08} ),
		},
		{
			BigInt: big.NewInt(9),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09} ),
		},
		{
			BigInt: big.NewInt(10),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0A} ),
		},
		{
			BigInt: big.NewInt(11),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0B} ),
		},
		{
			BigInt: big.NewInt(12),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C} ),
		},
		{
			BigInt: big.NewInt(13),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0D} ),
		},
		{
			BigInt: big.NewInt(14),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0E} ),
		},
		{
			BigInt: big.NewInt(15),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F} ),
		},
		{
			BigInt: big.NewInt(16),
			Expected: ethaddr.Something( [20]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10} ),
		},



		{
			BigInt: func()*big.Int{
				var str string = "5aAeb6053F3E94C9b9A09f33669435E7Ef1BeAed"

				var bigint big.Int
				_, ok := bigint.SetString(str, 16)
				if !ok {
					panic(fmt.Sprintf("could not load (hexadecimal) %s into big-int", str))
				}

				return &bigint
			}(),
			Expected: ethaddr.Something( [20]byte{0x5a,0xAe,0xb6,0x05,0x3F,0x3E,0x94,0xC9,0xb9,0xA0,0x9f,0x33,0x66,0x94,0x35,0xE7,0xEf,0x1B,0xeA,0xed} ),
		},



		{
			BigInt: func()*big.Int{
				var str string = "1461501637330902918203684832716283019655932542975"

				var bigint big.Int
				_, ok := bigint.SetString(str, 10)
				if !ok {
					panic(fmt.Sprintf("could not load (decimal) %s into big-int", str))
				}

				return &bigint
			}(),
			Expected: ethaddr.Something( [20]byte{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF} ),
		},
	}

	for testNumber, test := range tests {

		var actual ethaddr.Address
		var err error

		actual, err = ethaddr.BigInt(test.BigInt)
		if nil != err {
			t.Errorf("For test #%d, did not expect an error but actually got one.", testNumber)
			t.Logf("ERROR: (%T) %s", err, err)
			t.Logf("BIG-INT: %s", test.BigInt)
			continue
		}

		{
			expected := test.Expected

			if expected != actual {
				t.Errorf("For test #%d, the actual address is not what was expected", testNumber)
				t.Logf("EXPECTED: %s (%#v)", expected, expected.Bytes())
				t.Logf("ACTUAL:   %s (%#v)", actual,   actual.Bytes())
				t.Logf("BIG-INT: %s", test.BigInt)
				continue
			}
		}
	}
}


